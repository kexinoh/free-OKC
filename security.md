# Security Policy (English)

## Overview
OKCVM is a self-hosted orchestration layer exposing a FastAPI web service and an agent runtime capable of executing shell commands, file operations, and network calls. Because the runtime has privileged tool access, every deployment must be treated as sensitive infrastructure.

## Vulnerability Reporting
If you discover a security issue, please submit a private report via the repository's GitHub Security Advisories interface (Security tab → "Report a vulnerability"). Do **not** open a public issue for potential vulnerabilities.

## Threat Model

### Protected Assets
- Agent system prompts, tool specifications, and session transcripts.
- API keys and endpoint credentials sourced from `config.yaml` or environment variables.
- Workspace files created through file tools and artifacts generated by shell commands.
- Availability of the FastAPI service and background worker threads.

### Anticipated Adversaries
- Remote unauthenticated users on the same network, because the default server exposes an unauthenticated API with permissive CORS.
- Malicious authenticated operators who gain UI access and can trigger tool execution.
- Local users or processes on the host with filesystem access to configuration secrets.
- Supply-chain attackers compromising dependencies or pre-built frontend assets.

### Out-of-Scope Threats and Assumptions
- Hosts, hypervisors, and operators with full administrative access to the underlying machine or Kubernetes cluster are trusted. We do **not** attempt to defend against attackers who already control the server, so local data is stored in plaintext and at-rest encryption is not provided.
- Deployments are expected to run in trusted, access-controlled networks. Exposing services directly to the public internet without compensating controls is out of scope.
- Users operating the UI are assumed to be authorized to execute arbitrary tools; the project does not implement fine-grained per-tool authorization.
- Secrets should be provisioned by external infrastructure (environment injection, secret managers). The project does not include secret rotation or vaulting features.

## Baseline Safeguards
- **Network Hardening:** Run the FastAPI service behind HTTPS terminators and mutual-auth gateways (reverse proxy, zero-trust proxy, or VPN). Restrict inbound traffic with firewall rules and avoid binding to public interfaces.
- **Authentication & Authorization:** Add an external authentication layer (e.g., OAuth2 proxy) before exposing `/api/*` or `/ui/*`. Limit operator accounts to least privilege and monitor for anomalous tool usage.
- **Secrets Management:** Remove sample API keys from `config.yaml` before deployment. Load credentials from environment variables or a dedicated secret manager and scope each key to the minimal permissions needed.
- **Sandboxing:** Run the orchestrator inside a container or VM with limited filesystem access. If shell or file tools are enabled, mount dedicated workspaces and avoid host root access.
- **Dependency Hygiene:** Keep Python and frontend dependencies patched. Use tools such as `pip-audit` or Dependabot and verify checksums for downloaded assets.
- **Logging & Monitoring:** Centralize FastAPI access logs and tool execution logs. Configure alerting for repeated failures, unexpected tool invocations, or outbound traffic spikes.
- **Data Retention:** Regularly purge session histories and workspace artifacts that contain sensitive information. Apply filesystem permissions appropriate to the data sensitivity.

## Incident Response
1. Isolate the affected deployment (disable inbound traffic, revoke exposed credentials).
2. Review agent history, shell outputs, and system logs to scope the incident.
3. Rotate API keys and regenerate configuration files before restoring service.
4. Submit a disclosure via GitHub Security Advisories with observed indicators of compromise.

## Responsible Disclosure Commitment
We will review every private vulnerability report promptly, work with reporters on remediation timelines, and publicly acknowledge contributions when appropriate.

---

# 安全策略（中文）

## 概述
OKCVM 是一个自托管的编排层，提供 FastAPI Web 服务和能够执行 Shell 命令、文件操作以及网络调用的智能体运行时。由于运行时具备高度权限的工具访问能力，部署时必须视其为高敏感度基础设施。

## 漏洞报告
如发现安全问题，请通过仓库的 GitHub Security Advisories 功能私下提交报告（Security 标签 → “Report a vulnerability”），切勿在公开 Issue 中披露潜在漏洞。

## 威胁模型

### 关键资产
- 智能体的系统提示词、工具规范和会话历史。
- `config.yaml` 或环境变量中的 API 密钥与端点凭据。
- 通过文件工具创建的工作区文件以及 Shell 命令生成的任何产物。
- FastAPI 服务及后台线程的可用性。

### 主要对手
- 同一网络内的远程未认证用户（默认服务器无鉴权且启用了宽松的 CORS）。
- 获得 UI 访问权、能够触发工具执行的恶意认证操作者。
- 拥有宿主机文件系统访问权、可读取配置密钥的本地用户或进程。
- 可能通过依赖项或预构建前端资源实施攻击的供应链对手。

### 非目标威胁与假设
- 拥有服务器或宿主机完全管理员权限的人员、宿主机或虚拟化平台默认被视为可信。我们不试图防御已经控制服务器的攻击者，因此本地数据以明文形式存储，不提供静态加密。
- 假设部署运行在受信任且访问受控的网络环境；未经额外防护直接暴露在公网超出项目范围。
- 假设使用界面的人员已被授权，可执行任意工具；项目未提供细粒度的工具级授权控制。
- 假设密钥通过外部基础设施（环境变量注入、密钥管理服务）下发；项目未内置密钥轮换或保管功能。

## 基础防护措施
- **网络加固：** 建议将 FastAPI 服务部署在支持 HTTPS 与双向认证的网关或反向代理之后，通过防火墙限制入站流量并避免绑定公网地址。
- **身份验证与授权：** 在暴露 `/api/*` 或 `/ui/*` 之前添加外部鉴权层（如 OAuth2 代理），以最小权限原则管理操作账号并监测异常工具调用。
- **密钥管理：** 部署前删除 `config.yaml` 中的示例 API 密钥，通过环境变量或专用密钥管理系统加载凭据，并为每个密钥配置最小权限。
- **隔离运行：** 建议在受限的容器或虚拟机中运行编排器。如需启用 Shell 或文件工具，请挂载隔离的工作目录并避免接触宿主机根目录。
- **依赖安全：** 及时更新 Python 与前端依赖，可使用 `pip-audit` 或 Dependabot，并校验下载资源的完整性。
- **日志与监控：** 将 FastAPI 访问日志与工具执行日志集中收集，对重复失败、异常工具调用或出站流量激增设置告警。
- **数据保留：** 定期清理包含敏感信息的会话记录与工作区文件，并根据数据敏感度配置合适的文件系统权限。

## 事件响应
1. 隔离受影响的部署（阻断入站流量，吊销泄露的凭据）。
2. 审查智能体历史、Shell 输出及系统日志以界定事件范围。
3. 在恢复服务前轮换 API 密钥并重新生成配置文件。
4. 通过 GitHub Security Advisories 提交事件披露和入侵指示。

## 负责任披露承诺
我们承诺及时处理每一份私密漏洞报告，与报告者协商修复时间表，并在适当情况下公开致谢。
