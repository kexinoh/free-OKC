<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OK Computer 创意工坊</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="app-workspace">
      <aside class="history-sidebar" id="history-sidebar">
        <button
          type="button"
          class="history-toggle"
          id="history-toggle"
          aria-expanded="false"
          aria-controls="history-panel"
          aria-label="切换历史会话侧栏"
        >
          <span class="history-toggle-icon" aria-hidden="true">💾</span>
          <span class="history-toggle-label"></span>
        </button>
        <div class="history-panel" id="history-panel" tabindex="-1">
          <div class="history-panel-header">
            <h2>历史会话</h2>
            <button type="button" class="ghost-button history-new" id="new-conversation">
              <span aria-hidden="true">＋</span>
              <span>新建对话</span>
            </button>
          </div>
          <p class="history-empty" id="conversation-empty">暂无会话记录</p>
          <ul class="conversation-list" id="conversation-list"></ul>
        </div>
      </aside>

      <div class="app-shell">
        <header class="app-header">
        <div class="logo-area">
          <span class="logo">OK</span>
          <div>
            <h1>Free-OK Computer 创意工坊</h1>
            <p>以对话驱动的自动化AGENT</p>
          </div>
        </div>
        <div class="header-actions">
          <div class="status-pill" id="status-pill">待命中…</div>
          <button
            type="button"
            class="settings-toggle"
            id="settings-toggle"
            aria-haspopup="dialog"
            aria-expanded="false"
          >
            <span aria-hidden="true">⚙️</span>
            <span>服务配置</span>
          </button>
        </div>
      </header>

        <main class="app-main">
        <section class="chat-panel">
          <div class="chat-messages" id="chat-messages"></div>
          <form class="chat-input" id="chat-form">
            <div class="chat-input-editor">
              <textarea
                id="user-input"
                rows="2"
                placeholder="试着说：帮我创建一个个人简历网页"
                required
              ></textarea>
              <p class="chat-input-hint" id="chat-editing-hint" hidden>
                正在编辑历史消息，点击“发送”完成修改。
              </p>
            </div>
            <div class="chat-input-actions">
              <button type="submit" class="send-button">发送</button>
            </div>
          </form>
        </section>

        <aside class="insight-panel">
          <section class="insight-card">
            <h2>当前模型调用</h2>
            <ul class="model-log" id="model-log"></ul>
            <p class="empty-state" id="model-log-empty">暂无调用记录</p>
          </section>

          <section class="insight-card" id="web-preview-card" hidden>
            <div class="preview-header">
              <h2>网页预览</h2>
              <button class="ghost-button" id="open-web-preview" type="button" disabled>
                新窗口打开
              </button>
            </div>
            <div class="preview-frame">
              <iframe id="web-preview-frame" title="网页预览" sandbox="allow-popups"></iframe>
              <p class="empty-state" id="web-preview-empty">
                生成内容后将在这里展示网页效果。
              </p>
            </div>
          </section>

          <section class="insight-card" id="ppt-preview-card" hidden>
            <div class="preview-header">
              <h2>PPT 预览</h2>
              <button class="ghost-button" id="toggle-ppt-mode" type="button" disabled>
                幻灯模式
              </button>
            </div>
            <div class="ppt-preview" id="ppt-preview"></div>
            <p class="empty-state" id="ppt-preview-empty">
              等待生成幻灯片内容…
            </p>
          </section>
        </aside>
        </main>
      </div>
    </div>

    <div class="settings-overlay" id="settings-overlay" hidden>
      <div
        class="settings-drawer"
        role="dialog"
        aria-modal="true"
        aria-labelledby="settings-title"
        tabindex="-1"
      >
        <div class="settings-drawer-header">
          <div class="settings-header">
            <h2 id="settings-title">模型配置</h2>
            <p>为聊天、图像、语音与音频工具填写推理端点信息。</p>
          </div>
          <button
            type="button"
            class="ghost-button settings-close"
            data-action="close-settings"
            aria-label="关闭配置面板"
          >
            关闭
          </button>
        </div>

        <form class="config-form" id="config-form">
          <fieldset class="config-group">
            <legend>聊天模型</legend>
            <label>
              模型 ID
              <input type="text" data-service="chat" data-field="model" placeholder="moonshot-chat" />
            </label>
            <label>
              Base URL
              <input type="url" data-service="chat" data-field="base_url" placeholder="https://api.example.com/v1/chat" />
            </label>
            <label>
              API Key
              <input type="password" data-service="chat" data-field="api_key" placeholder="••••••" autocomplete="off" />
            </label>
          </fieldset>

          <fieldset class="config-group">
            <legend>图像生成</legend>
            <label>
              模型 ID
              <input type="text" data-service="image" data-field="model" placeholder="moonshot-image" />
            </label>
            <label>
              Base URL
              <input type="url" data-service="image" data-field="base_url" placeholder="https://api.example.com/v1/images" />
            </label>
            <label>
              API Key
              <input type="password" data-service="image" data-field="api_key" placeholder="••••••" autocomplete="off" />
            </label>
          </fieldset>

          <fieldset class="config-group">
            <legend>语音合成</legend>
            <label>
              模型 ID
              <input type="text" data-service="speech" data-field="model" placeholder="moonshot-tts" />
            </label>
            <label>
              Base URL
              <input type="url" data-service="speech" data-field="base_url" placeholder="https://api.example.com/v1/speech" />
            </label>
            <label>
              API Key
              <input type="password" data-service="speech" data-field="api_key" placeholder="••••••" autocomplete="off" />
            </label>
          </fieldset>

          <fieldset class="config-group">
            <legend>音效生成</legend>
            <label>
              模型 ID
              <input type="text" data-service="sound_effects" data-field="model" placeholder="moonshot-sfx" />
            </label>
            <label>
              Base URL
              <input type="url" data-service="sound_effects" data-field="base_url" placeholder="https://api.example.com/v1/sfx" />
            </label>
            <label>
              API Key
              <input type="password" data-service="sound_effects" data-field="api_key" placeholder="••••••" autocomplete="off" />
            </label>
          </fieldset>

          <fieldset class="config-group">
            <legend>语音识别</legend>
            <label>
              模型 ID
              <input type="text" data-service="asr" data-field="model" placeholder="moonshot-asr" />
            </label>
            <label>
              Base URL
              <input type="url" data-service="asr" data-field="base_url" placeholder="https://api.example.com/v1/asr" />
            </label>
            <label>
              API Key
              <input type="password" data-service="asr" data-field="api_key" placeholder="••••••" autocomplete="off" />
            </label>
          </fieldset>

          <div class="config-actions">
            <span class="config-status" id="config-status" role="status"></span>
            <button type="submit" class="primary-button">保存配置</button>
          </div>
        </form>
      </div>
    </div>

    <template id="model-log-item-template">
      <li class="model-log-item">
        <header>
          <span class="model-name"></span>
          <time class="model-time"></time>
        </header>
        <p class="model-summary"></p>
        <dl class="model-meta">
          <div>
            <dt>输入 Token</dt>
            <dd class="meta-input"></dd>
          </div>
          <div>
            <dt>输出 Token</dt>
            <dd class="meta-output"></dd>
          </div>
          <div>
            <dt>耗时</dt>
            <dd class="meta-latency"></dd>
          </div>
        </dl>
      </li>
    </template>

    <template id="ppt-slide-template">
      <section class="ppt-slide">
        <h3></h3>
        <ul></ul>
      </section>
    </template>

    <script type="module" src="app/index.js"></script>
  </body>
</html>
